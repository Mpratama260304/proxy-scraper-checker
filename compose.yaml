services:
  app:
    build:
      args:
        - "UID=${UID:-1000}"
        - "GID=${GID:-1000}"
      pull: true
    init: true
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - RUST_BINARY_PATH=/usr/local/bin/proxy-scraper-checker
      - OUTPUT_DIR=/app/out
      - CONFIG_PATH=/app/config.toml
      - RUN_INITIAL_CHECK=true
      - NODE_ENV=production
    volumes:
      - proxy_scraper_checker_cache:/home/app/.cache/proxy_scraper_checker
      - ./out:/app/out
      - ./config.toml:/app/config.toml
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
volumes:
  proxy_scraper_checker_cache:
